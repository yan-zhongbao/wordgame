# WordGame 功能与实现说明

本文档概述当前项目中各个游戏/模式的核心玩法与实现方式，便于维护和扩展。

## 通用基础

- 词库来源：`words.json`，每条包含 `day`、`en`、`zh`、`kind` 等字段。
- 关卡参数：页面通过 `?day=数字` 读取关卡序号。
- 金币系统（共享）：`localStorage` 键 `wg-td-coins`。
- 错词复习：`localStorage` 键 `wg-review`，记录错词、复习节奏。
- 拼写统计：`localStorage` 键 `wg-spell-stats`，记录拼写错误/连续错误。
- 关卡质量：`localStorage` 键 `wg-day-stats`，记录通关星级/分数/错误次数。
- PWA 离线：`sw.js` 缓存核心资源；页面内有“更新”按钮触发 SW 更新。
- 音频：`audio/en` 与 `audio/phrase` 按英文 slug 命名；缺失时回退到 TTS。

### 星级规则（全局统一）

- 0 错误：3 星
- 1–2 错误：2 星
- 3–4 错误：1 星
- ≥5 错误：0 星  

各游戏中星级实时刷新，初始三颗金色星。

## 关卡选择页（`index.html` + `index.js`）

**主要功能**

- 展示 1–21 关卡列表。
- 显示每关：单词数、错词数、挑战质量（星级）。
- 显示全局金币数量。
- 点击进入训练页：`practice.html?day=...`。

**实现要点**

- 读取 `words.json` 统计每关单词数。
- 读取 `wg-review` 统计每关错词数。
- 读取 `wg-day-stats` 显示挑战质量。
- “更新”按钮触发 Service Worker 重新拉取缓存。

## 单词训练（`practice.html` + `app.js`）

**主要功能**

- Stage 0 复活区（复习错词）
- Stage 1 新词识别（选词）
- Stage 2 拼写训练（多模式）
- Stage 3 中文意思（选词）
- 自动读音与可重听按钮
- 错误会扣分并记录复习
- 实时星级与分数

**实现要点**

- `buildStageQueues(day)` 组合各阶段队列。
- 复习错词来自 `wg-review`；拼写统计来自 `wg-spell-stats`。
- Stage 2 使用多种拼写模式（拼读块、缺字母、错误修复、闪现等）。
- 拼写块可根据音素/常见字母组合切分，短语支持空格与 `/`。
- 错一次、连错三次会插入补充训练模式。
- 通关后写入 `wg-day-stats`，用于关卡列表展示星级。

## 单词大战作业（`td.html` + `td.js`）

**主要功能**

- 拖拽种子建立炮台，填字母完成拼写触发射击。
- 怪物（作业）沿轨道移动，抵达书包累积负担。
- 多种炮台与弹药效果（pear/banana/apple/coconut/cucumber/blueberry）。
- 工具：锄头、钥匙、号角、指挥棒等。
- 金币系统与奖励动画。
- 胜利后泡泡/烟花等结算演出。
- 实时星级（统计拼写错误次数）。

**实现要点**

- 种植区 6 槽；字母拖拽填空。
- 错误拼写会扣炮台耐久，并触发错误提示与音效。
- 敌人血条 + 伤害数字；击败后掉落金币。
- 生成逻辑按时间节奏与血量预算控制难度，避免堆叠。
- 星级基于 `TD.errors`，在 `handleWrongShot` 中累加。

## 贪吃蛇记忆（`snake.html` + `snake.js`）

**主要功能**

- 拖动蛇头按顺序吃字母，拼接完整单词与短语。
- 错误字母会回退一个已吃字母。
- 词组内空格、`/`、`-` 作为分隔节点。
- 工具：冻结、加速、自动锁定。
- 每完成一个单词奖励金币。
- 实时星级（统计错误吃字母次数）。

**实现要点**

- 字母泡泡随机移动，蛇头追随指尖。
- `state.sequence` 保存当前需要吃的字符序列。
- `safeProgress` 用于短语分隔节点的“安全回退”。
- 词完成后加入分隔节，最终形成长蛇展示。
- 星级基于 `state.errors`，在吃错时递增。

## 单词寻宝（`wordsearch.html` + `wordsearch.js`）

**主要功能**

- 12x12 字母网格，寻找单词（横/竖/斜向）。
- 右侧中文列表，找到后变成“英文 · 中文”。
- 正确加金币，错误扣金币（不足时不扣）。
- 道具：手电筒、点名机、X 光、举手、炸弹、雷达。
- 实时星级（统计错误连线次数）。

**实现要点**

- 仅使用单词（过滤短语），按关卡 `day` 加载。
- 允许交叉共用相同字母；不允许从右到左或从下到上。
- 点名机：选中字母后高亮全部相同字母 5 秒。
- X 光：显示单词轮廓并添加 50% 干扰字母。
- 星级基于 `state.errors`，在选错时递增。

---

如需补充“关卡质量”的计算、音频策略或道具规则细节，可以继续完善此文档。  
